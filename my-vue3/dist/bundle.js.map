{"version":3,"file":"bundle.js","sources":["../src/reactity/effect.ts","../src/share/index.ts","../src/reactity/baseHandlers.ts","../src/reactity/reactive.ts","../src/reactity/computed.ts"],"sourcesContent":["\r\nexport const effectStack = []\r\nexport const effect = (fn, options: any = {}) => {\r\n    const effect = createReactiveEffect(fn, options)\r\n    if (!options.lazy) {\r\n        effect();\r\n    }\r\n    return effect\r\n}\r\nlet activeEffect = null;\r\nlet id = 0;\r\nfunction createReactiveEffect(fn, options) {\r\n    const effect = function reactiveEffect() {\r\n        if (!effectStack.includes(effect)) {\r\n            try {\r\n                effectStack.push(effect)\r\n                activeEffect = effect\r\n                return fn()\r\n            } finally {\r\n                effectStack.pop();\r\n                activeEffect = effectStack[effectStack.length - 1]\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n    effect.id = id++;\r\n    effect.options = options;\r\n    return effect\r\n}\r\nlet targetMap = new WeakMap();\r\nexport function track(target, key) {\r\n    if (activeEffect == undefined) {\r\n        return\r\n    }\r\n    let depsMap = targetMap.get(target)\r\n    if (!depsMap) {\r\n        targetMap.set(target, (depsMap = new Map()))\r\n    }\r\n    let dep = depsMap.get(key);\r\n    if (!dep) {\r\n        depsMap.set(key, (dep = new Set()))\r\n    }\r\n    if (!dep.has(activeEffect)) {\r\n        dep.add(activeEffect);\r\n    }\r\n\r\n}\r\nconst run = (effects) => {\r\n    effects.forEach(effect => {\r\n        if (effect.options.scheduler) {\r\n            effect.options.scheduler.call(effect);\r\n        } else {\r\n            effect()\r\n        }\r\n    })\r\n}\r\nexport function trigger(target, type, key, value?) {\r\n    let depsMap = targetMap.get(target)\r\n    if (!depsMap) return\r\n    let effects = depsMap.get(key);\r\n    run(effects)\r\n}","export const isObject = (val) => typeof val === 'object' && val !== null\r\nexport const isArray = (target) => Array.isArray(target)\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty\r\nexport const isOwnProperty = (target, key) => hasOwnProperty.call(target, key)\r\nexport const isFunction = (val) => typeof val === 'function'","import { isObject } from \"../share\";\r\nimport { effectStack, track, trigger } from \"./effect\";\r\nimport { reactive } from \"./reactive\";\r\n\r\nexport const mutableHandlers = {\r\n    get(target, key, recevier) {\r\n        console.log('get');\r\n        let res = Reflect.get(target, key, recevier);\r\n        track(target, key)\r\n        if (res.__v_isRef) {\r\n            return res.value;\r\n        }\r\n        return isObject(res) ? reactive(res) : res\r\n    },\r\n    set(target, key, newVal, recevier) {\r\n        console.log('set')\r\n        let result = Reflect.set(target, key, newVal, recevier);\r\n        trigger(target, 'set', key, newVal)\r\n        return result\r\n    }\r\n}","import { isObject } from \"../share\"\r\nimport { mutableHandlers } from \"./baseHandlers\"\r\n\r\nexport const reactive = (target: any) => {\r\n    return createProxyObj(target, mutableHandlers)\r\n}\r\nconst weekmap = new WeakMap()\r\nconst createProxyObj = (target: any, handler: object) => {\r\n    if (!isObject(target)) return target;\r\n    const exitProxy = weekmap.get(target)\r\n    if (exitProxy) {\r\n        return exitProxy\r\n    }\r\n    const proxy = new Proxy(target, handler)\r\n    weekmap.set(target, proxy)\r\n    return proxy\r\n}","import { isFunction } from \"../share\";\r\nimport { effect, track, trigger } from \"./effect\";\r\nclass ComputedRefImpl {\r\n    public setter\r\n    public effect\r\n    public _dirty = true\r\n    public _value\r\n    public readonly __v_isRef = true\r\n    constructor(getter, setter) {\r\n        this.setter = setter\r\n        this.effect = effect(getter, {\r\n            lazy: true,\r\n            scheduler: () => {\r\n                this._dirty = true;\r\n                trigger(this, 'set', 'value')\r\n            }\r\n        })\r\n    }\r\n    get value() {\r\n        if (this._dirty) {\r\n            this._value = this.effect();\r\n            track(this, 'value')\r\n            this._dirty = false\r\n        }\r\n        return this._value\r\n    }\r\n    set value(newVal) {\r\n        this.setter(newVal)\r\n    }\r\n\r\n}\r\n\r\nexport function computed(options) {\r\n    let getter, setter\r\n    if (isFunction(options)) {\r\n        getter = options;\r\n        setter = () => {\r\n            console.log('computed  not set value');\r\n        }\r\n    } else {\r\n        getter = options.get\r\n        setter = options.set\r\n    }\r\n    return new ComputedRefImpl(getter, setter)\r\n}"],"names":[],"mappings":"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"}